#periodics:
#- interval: 10m
#  name: echo-test
#  decorate: true
#  spec:
#    containers:
#    - image: alpine
#      command: ["/bin/date"]
      
presubmits:
  belitradas/test-infra:
    - name: test-prow-config
      context: test-prow-config
      decorate: true 
      always_run: false 
      skip_report: false 
      max_concurrency: 1 
      trigger: "(?m)test-prow-config( please)?" 
      rerun_command: "test-prow-config"
      run_if_changed: '^(config/.*|prow/.*)$'
      spec: 
        containers:
          - name: "test-config"
            command:
              - checkconfig
            args:
              - --plugin-config=/home/prow/go/src/github.com/belitradas/test-infra/prow/config.yaml
              - --config-path=/home/prow/go/src/github.com/belitradas/test-infra/prow/plugins.yaml
              - --job-config-path=/home/prow/go/src/github.com/belitradas/test-infra/config/jobs
            image: belitre/checkconfig:latest
            imagePullPolicy: Always
    - name: test-prow-manifests
      context: test-prow-manifests
      decorate: true 
      always_run: false 
      skip_report: false 
      max_concurrency: 1 
      trigger: "(?m)test-prow-manifests( please)?" 
      rerun_command: "test-prow-manifests"
      run_if_changed: 'prow/manifests/'
      spec: 
        serviceAccountName: prow
        containers:
          - name: "test-manifests"
            command:
              - make
            args:
              - deploy-prow-dry-run
            image: belitre/kubectl:1.14.2
            imagePullPolicy: Always

postsubmits:
  belitradas/test-infra:
    - name: test-config-postsubmit
      decorate: true
      max_concurrency: 1 
      run_if_changed: '^(config/.*|prow/.*)$'
      branches:
        - master
      spec:
        containers:
          - name: "test-config"
            command:
              - checkconfig
            args:
              - --plugin-config=/home/prow/go/src/github.com/belitradas/test-infra/prow/config.yaml
              - --config-path=/home/prow/go/src/github.com/belitradas/test-infra/prow/plugins.yaml
              - --job-config-path=/home/prow/go/src/github.com/belitradas/test-infra/config/jobs
            image: belitre/checkconfig:latest
            imagePullPolicy: Always
    - name: test-prow-manifests-postsubmit
      decorate: true 
      max_concurrency: 1 
      run_if_changed: 'prow/manifests/'
      branches:
        - master
      spec: 
        serviceAccountName: prow
        containers:
          - name: "test-manifests"
            command:
              - make
            args:
              - deploy-prow
            image: belitre/kubectl:1.14.2
            imagePullPolicy: Always